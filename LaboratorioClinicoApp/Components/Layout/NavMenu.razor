@page "/menu"
@inject NavigationManager Nav
@inject LaboratorioClinicoApp.Services.AuthServices AuthService

<link rel="stylesheet" href="css/menu.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<div class="hamburger-menu-container">
    @if (IsLoggedIn)
    {
        <button class="hamburger-btn" id="menuToggle" @onclick="ToggleMenu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </button>
    }

    <h4 class="menu-logo">Laboratorio Clinico</h4>
</div>

@if (IsLoggedIn)
{
    <nav class="side-menu @(IsMenuOpen ? "open" : "")" id="sideMenu">
        <ul>
            @foreach (var item in menuItems)
            {
                if (ShouldShow(item))
                {
                    <li>
                        <a @onclick="() => NavigateTo(item.Url)">
                            <i class="@item.Icon"></i>
                            <span>@item.Label</span>
                        </a>
                    </li>
                }
            }
        </ul>
    </nav>
}

@code {
    private bool IsLoggedIn;
    private bool IsMenuOpen = false;
    private string currentPage = "";

    private List<MenuItem> menuItems = new()
    {
        new("/dashboard", "fas fa-home", "Dashboard"),
        new("/citas", "fas fa-calendar-check", "Citas"),
        new("/consulta", "fas fa-stethoscope", "Consultas"),
        new("/doctores", "fas fa-user-md", "Doctores"),
        new("/pacientes", "fas fa-users", "Pacientes"),
        new("/examenes", "fas fa-microscope", "Exámenes"),
        new("/resultados", "fas fa-vials", "Resultados"),
        new("/roles", "fas fa-user-shield", "Roles"),
        new("/logout", "fas fa-sign-out-alt", "Cerrar sesión")
    };

    protected override async Task OnInitializedAsync()
    {
        IsLoggedIn = await AuthService.IsAuthenticated();
        currentPage = Nav.Uri.Replace(Nav.BaseUri, "/").ToLower();
    }

    private void NavigateTo(string url)
    {
        currentPage = url.ToLower();
        Nav.NavigateTo(url);
        IsMenuOpen = false; // Cierra el menú al seleccionar
    }

    private bool ShouldShow(MenuItem item)
    {
        return !string.Equals(item.Url.ToLower(), currentPage, StringComparison.OrdinalIgnoreCase);
    }

    private void ToggleMenu()
    {
        IsMenuOpen = !IsMenuOpen;
    }

    private record MenuItem(string Url, string Icon, string Label);
}
