@page "/roles/editar/{id:int}"
@using LaboratorioClinicoApp.Services
@using LaboratorioClinicoApp.DTO
@inject RolService rolService
@inject NavigationManager navManager

<link rel="stylesheet" href="/css/Rol/agregarRol.css" />

<div class="agregar-container">

    <div class="header">
        <button class="btn-back" @onclick="Volver">
            ←
        </button>
        <h2>Editar Rol</h2>
    </div>

    @if (!string.IsNullOrEmpty(mensajeError))
    {
        <div class="error">@mensajeError</div>
    }

    @if (rol == null)
    {
        <p>Cargando datos...</p>
    }
    else
    {
        <div class="formulario">

            <!-- Nombre -->
            <label class="label-text">Nombre del Rol</label>
            <input class="@GetInputClass(rol.Nombre)"
                   placeholder="Escribe el nombre del rol..."
                   @bind="rol.Nombre" />

            <!-- Descripción -->
            <label class="label-text">Descripción</label>
            <textarea class="@GetInputClass(rol.Descripcion)"
                      placeholder="Escribe una descripción del rol..."
                      @bind="rol.Descripcion">
                </textarea>

            <!-- Estado Switch -->
            <label class="label-text">Estado</label>

            <div class="switch-container" @onclick="ToggleEstado">
                <div class="switch @(rol.Estado ? "on" : "off")">
                    @(rol.Estado ? "Activo" : "Inactivo")
                </div>
            </div>

            <button class="btn-guardar" @onclick="GuardarCambios">
                Guardar Cambios
            </button>

        </div>
    }
</div>

@code {
    private RolDTO? rol;
    private string? mensajeError;

    [Parameter]
    public int id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            rol = await rolService.GetRolById(id);

            if (rol == null)
            {
                mensajeError = "El rol no existe.";
            }
        }
        catch (Exception ex)
        {
            mensajeError = ex.Message;
        }
    }

    // Cambiar estado con switch
    void ToggleEstado()
    {
        rol.Estado = !rol.Estado;
    }

    // Validación visual
    string GetInputClass(string value) =>
        string.IsNullOrWhiteSpace(value) ? "input error-border" : "input";

    private async Task GuardarCambios()
    {
        if (string.IsNullOrWhiteSpace(rol!.Nombre) ||
            string.IsNullOrWhiteSpace(rol.Descripcion))
        {
            mensajeError = "Por favor llena todos los campos.";
            return;
        }

        try
        {
            await rolService.UpdateRol(id, rol);
            navManager.NavigateTo("/roles");
        }
        catch (Exception ex)
        {
            mensajeError = $"Error al actualizar: {ex.Message}";
        }
    }

    private void Volver()
    {
        navManager.NavigateTo("/roles");
    }
}
