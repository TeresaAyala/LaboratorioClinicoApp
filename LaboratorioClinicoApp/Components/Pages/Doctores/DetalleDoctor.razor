@page "/doctores/detalle/{id:int}"

@using LaboratorioClinicoApp.Services
@using LaboratorioClinicoApp.DTO
@inject DoctorService doctorService
@inject NavigationManager nav

<link rel="stylesheet" href="/css/Doctores/detalleDoctor.css" />

@if (cargando)
{
    <div class="detalle-container">
        <p>Cargando información del doctor...</p>
    </div>
}
else if (doctor == null)
{
    <div class="detalle-container">
        <p>No se encontró el doctor.</p>
        <button class="btn-volver" @onclick="Volver">Volver</button>
    </div>
}
else
{
    <div class="detalle-container">

        <!-- BOTÓN VOLVER ARRIBA -->
        <button class="btn-volver" @onclick="Volver">‹ Volver</button>

        <div class="card-detalle">

            <!-- AVATAR -->
            <div class="avatar-wrapper">
                @if (!string.IsNullOrEmpty(doctor.FotoUrl))
                {
                    <img src="@doctor.FotoUrl" class="avatar-img" />
                }
                else
                {
                    <div class="avatar-fallback" style="background:@Color">
                        @doctor.Nombre.Substring(0, 1).ToUpper()
                    </div>
                }
            </div>

            <h2>@doctor.Nombre @doctor.Apellido</h2>
            <p class="especialidad">@doctor.Especialidad</p>

            <p class="estado @(doctor.Estado == "Activo" ? "activo" : "inactivo")">
                Estado: @doctor.Estado
            </p>

            <hr />

            <!-- INFORMACIÓN PROFESIONAL -->
            <h3 class="section-title">Información Profesional</h3>
            <div class="info-grid">
                <div>
                    <label>Licencia Médica:</label>
                    <p>@doctor.LicenciaMedica</p>
                </div>

                <div>
                    <label>ID Usuario Asignado:</label>
                    <p>@doctor.IdUsuario</p>
                </div>
            </div>

            <!-- INFORMACIÓN DE CONTACTO -->
            <h3 class="section-title">Contacto</h3>
            <div class="info-grid">
                <div>
                    <label>Correo:</label>
                    <p>@(string.IsNullOrEmpty(doctor.Email) ? "No registrado" : doctor.Email)</p>
                </div>

                <div>
                    <label>Teléfono:</label>
                    <p>@(string.IsNullOrEmpty(doctor.Telefono) ? "No registrado" : doctor.Telefono)</p>
                </div>
            </div>

            <!-- BOTONES (AGREGADO) -->
            <div class="acciones">
                <button class="btn-editar" @onclick="Editar">Editar</button>
                <button class="btn-volver" @onclick="Volver">Volver</button>
            </div>

        </div>
    </div>
}

@code {
    [Parameter] public int id { get; set; }

    private DoctorDTO? doctor;
    private bool cargando = true;

    List<string> Colores = new()
    {
        "#3f51b5","#009688","#9c27b0","#2196f3",
        "#ff9800","#e91e63","#4caf50","#795548"
    };

    string Color => Colores[id % Colores.Count];

    protected override async Task OnInitializedAsync()
    {
        doctor = await doctorService.GetDoctorById(id);
        cargando = false;
    }

    void Volver() => nav.NavigateTo("/doctores");

    void Editar() => nav.NavigateTo($"/doctores/editarDoctor/{id}");
}
