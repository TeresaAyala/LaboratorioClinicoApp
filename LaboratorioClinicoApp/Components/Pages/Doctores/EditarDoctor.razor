@page "/doctores/editarDoctor/{id}"
@using LaboratorioClinicoApp.Services
@using LaboratorioClinicoApp.DTO
@inject DoctorService doctorService
@inject NavigationManager navManager

<h3 class="text-center mb-4">Editar Doctor</h3>

@if (doctor == null)
{
    <div class="alert alert-info text-center">Cargando datos del doctor...</div>
}
else
{
    <div class="card p-4 shadow-sm">
        <EditForm Model="@doctor" OnValidSubmit="GuardarCambios">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <div class="mb-3">
                <label class="form-label">Nombre</label>
                <InputText @bind-Value="doctor.Nombre" class="form-control" placeholder="Ingrese el nombre del doctor" />
            </div>

            <div class="mb-3">
                <label class="form-label">Especialidad</label>
                <InputText @bind-Value="doctor.Especialidad" class="form-control" placeholder="Ingrese la especialidad" />
            </div>

            <div class="mb-3">
                <label class="form-label">Teléfono</label>
                <InputText @bind-Value="doctor.Telefono" class="form-control" placeholder="Ingrese el número de teléfono" />
            </div>

            <div class="mb-3">
                <label class="form-label">ID de Usuario</label>
                <InputNumber @bind-Value="doctor.IdUsuario" class="form-control" />
            </div>

            <div class="form-check mb-3">
                <InputCheckbox @bind-Value="doctor.Estado" class="form-check-input" />
                <label class="form-check-label">Activo</label>
            </div>

            <div class="d-flex justify-content-between">
                <button type="button" class="btn btn-secondary" @onclick="Cancelar">Cancelar</button>
                <button type="submit" class="btn btn-primary">Guardar Cambios</button>
            </div>
        </EditForm>

        @if (!string.IsNullOrEmpty(mensaje))
        {
            <div class="alert alert-info mt-3">@mensaje</div>
        }
    </div>
}

@code {
    [Parameter]
    public int Id { get; set; }   // 🔹 Viene desde la URL

    private DoctorDTO? doctor;
    private string? mensaje;

    protected override async Task OnInitializedAsync()
    {
        await CargarDoctor();
    }

    private async Task CargarDoctor()
    {
        try
        {
            doctor = await doctorService.GetDoctorById(Id);

            if (doctor == null)
            {
                mensaje = "No se encontró el doctor especificado.";
            }
        }
        catch (Exception ex)
        {
            mensaje = $"Error al cargar el doctor: {ex.Message}";
        }
    }

    private async Task GuardarCambios()
    {
        try
        {
            if (doctor != null)
            {
                await doctorService.UpdateDoctor(doctor.Id, doctor);
                mensaje = "✅ Cambios guardados correctamente.";
                await Task.Delay(1500);
                navManager.NavigateTo("/doctores");
            }
        }
        catch (Exception ex)
        {
            mensaje = $"❌ Error al guardar los cambios: {ex.Message}";
        }
    }

    private void Cancelar()
    {
        navManager.NavigateTo("/doctores");
    }
}
