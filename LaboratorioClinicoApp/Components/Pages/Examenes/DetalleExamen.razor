@page "/examenes/detalle/{id:int}"

@using LaboratorioClinicoApp.DTO
@using LaboratorioClinicoApp.Services

@inject ExamenService examenService
@inject PacienteService pacienteService
@inject NavigationManager nav

<h3 class="mb-4">Detalle del Examen</h3>

@if (examen == null)
{
    <p>Cargando...</p>
}
else
{
    <div class="card shadow-lg p-4">

        <h4>@examen.TipoExamen</h4>

        <p><strong>Descripción:</strong> @examen.Descripcion</p>

        <p><strong>Fecha:</strong> 
            @examen.Fecha.ToString("dd/MM/yyyy HH:mm")
        </p>

        <p><strong>Estado:</strong>
            <span class="badge bg-primary">@examen.Estado</span>
        </p>

        <p><strong>Paciente:</strong> @NombrePaciente()</p>

        <button class="btn btn-primary"
                @onclick='() => nav.NavigateTo($"/examenes/editarExamenes/{id}")'>
            Editar
        </button>

        <button class="btn btn-secondary ms-2"
                @onclick='() => nav.NavigateTo("/examenes")'>
            Regresar
        </button>
    </div>
}

@code {
    [Parameter] public int id { get; set; }

    ExamenDTO? examen;
    PacienteDTO? paciente;

    protected override async Task OnInitializedAsync()
    {
        examen = await examenService.GetExamenById(id);

        if (examen != null)
        {
            var allPacientes = await pacienteService.GetPacientes();
            paciente = allPacientes.FirstOrDefault(p => p.Id == examen.IdPaciente);
        }
    }

    private string NombrePaciente()
    {
        if (paciente != null)
            return $"{paciente.Nombre} {paciente.Apellido}";

        return examen?.PacienteNombre ?? "Sin datos";
    }
}
