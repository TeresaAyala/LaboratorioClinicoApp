@page "/examenes/editarExamen/{id:int}"

@using LaboratorioClinicoApp.DTO
@using LaboratorioClinicoApp.Services

@inject ExamenService examenService
@inject PacienteService pacienteService
@inject NavigationManager navManager

<link rel="stylesheet" href="/bootstrap/bootstrap.min.css" />
<link rel="stylesheet" href="/css/Examenes/formularioAgregarEditarExamen.css" />

<div class="offset-navbar">
    <div class="container">
        <h3 class="mb-4 titulo-centrado">Editar Examen</h3>

        @if (examen == null || pacientes == null)
        {
            <p>Cargando...</p>
        }
        else
        {
            <EditForm Model="examen" OnValidSubmit="ActualizarExamen">
                <DataAnnotationsValidator />
                <ValidationSummary />

                <div class="card p-4 shadow-sm">

                    <!-- 🔹 Paciente -->
                    <div class="mb-3">
                        <label class="form-label">Paciente</label>
                        <select class="form-select" @bind="examen.IdPaciente">
                            @foreach (var paciente in pacientes)
                            {
                                <option value="@paciente.Id">@paciente.Nombre</option>
                            }
                        </select>
                        <ValidationMessage For="@(() => examen.IdPaciente)" />
                    </div>

                    <!-- 🔹 Tipo de Examen -->
                    <div class="mb-3">
                        <label class="form-label">Tipo de Examen</label>
                        <InputText class="form-control" @bind-Value="examen.TipoExamen" />
                        <ValidationMessage For="@(() => examen.TipoExamen)" />
                    </div>

                    <!-- 🔹 Fecha -->
                    <div class="mb-3">
                        <label class="form-label">Fecha</label>
                        <InputDate class="form-control" @bind-Value="examen.Fecha" />
                        <ValidationMessage For="@(() => examen.Fecha)" />
                    </div>

                    <!-- 🔹 Botones -->
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary px-4">Guardar cambios</button>
                        <button type="button" class="btn btn-secondary ms-2" @onclick="Volver">
                            Cancelar
                        </button>
                    </div>

                </div>
            </EditForm>
        }
    </div>
</div>

@code {
    [Parameter] public int id { get; set; }

    private ExamenDTO? examen;
    private List<PacienteDTO>? pacientes;

    protected override async Task OnInitializedAsync()
    {
        examen = await examenService.GetExamenById(id);
        pacientes = await pacienteService.GetPacientes();
    }

    private async Task ActualizarExamen()
    {
        var mensaje = await examenService.UpdateExamen(id, examen);
        Console.WriteLine(mensaje);
        navManager.NavigateTo("/examenes");
    }

    private void Volver()
    {
        navManager.NavigateTo("/examenes");
    }
}
